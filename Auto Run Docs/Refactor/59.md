# Refactor Task 59: src/renderer/constants/shortcuts.ts

## Summary

This 74-line file defines keyboard shortcut configurations in three separate Record types. The file itself is well-structured with no internal issues, but reveals significant **duplication** with related shortcut handling code in `useKeyboardShortcutHelpers.ts` and `shortcutMatcher.ts`. Additionally, `shortcutMatcher.ts` exports 3 functions that are only used in tests - **dead code in production**. The mobile web interface has hardcoded keyboard handling rather than sharing from this constants file.

## Dead Code

1. **`src/renderer/utils/shortcutMatcher.ts` - Entire file is dead code in production:**
   - `matchShortcut()` function (68 lines) - only imported by `shortcutMatcher.test.ts`
   - `isAltMetaShortcut()` function - only imported by `shortcutMatcher.test.ts`
   - `isAltMetaNumberShortcut()` function - only imported by `shortcutMatcher.test.ts`
   - All three utility functions are never used in production code; the `useKeyboardShortcutHelpers.ts` hook implements duplicate matching logic directly instead

2. **Note:** All shortcuts defined in `shortcuts.ts` ARE actively used:
   - `DEFAULT_SHORTCUTS` (35 entries) - bound in `useMainKeyboardHandler.ts` via `ctx.isShortcut()`
   - `FIXED_SHORTCUTS` (8 entries) - displayed in `ShortcutsHelpModal.tsx`
   - `TAB_SHORTCUTS` (20 entries) - bound in `useMainKeyboardHandler.ts` via `ctx.isTabShortcut()`

## Deprecated Patterns

None found. The file uses modern TypeScript patterns with proper typing.

## Duplication

1. **Major: Shortcut matching logic duplicated 60+ lines:**
   - `src/renderer/utils/shortcutMatcher.ts:matchShortcut()` (~47 lines of matching logic)
   - `src/renderer/hooks/useKeyboardShortcutHelpers.ts:isShortcut()` (~44 lines of matching logic)
   - `src/renderer/hooks/useKeyboardShortcutHelpers.ts:isTabShortcut()` (~32 lines of matching logic)
   - All three implement the same modifier key checking, shift-symbol handling, and macOS Alt-key character mapping
   - The hook-based implementations are used; `shortcutMatcher.ts` is dead code

2. **Mobile keyboard handler ignores shared shortcuts:**
   - `src/web/hooks/useMobileKeyboardHandler.ts` hardcodes `Cmd+J`, `Cmd+[`, `Cmd+]` shortcuts inline
   - Does not import from `src/renderer/constants/shortcuts.ts`
   - Causes maintenance burden: changes to shortcuts require updating two places

3. **Test fixtures duplicate shortcut definitions:**
   - `src/__tests__/renderer/hooks/useSettings.test.ts` lines 238, 681 define custom `toggleSidebar` shortcuts
   - `src/__tests__/renderer/components/QuickActionsModal.test.tsx` line 70 defines test shortcuts
   - `src/__tests__/renderer/components/SessionList.test.tsx` line 112 defines mock shortcuts
   - These are expected in test fixtures but could use shared test utilities

## Code Smells

1. **FIXED_SHORTCUTS has 5 entries with identical key bindings:**
   - Lines 43-47: `filterFiles`, `filterSessions`, `filterHistory`, `searchLogs`, `searchOutput` all use `['Meta', 'f']`
   - This is intentional (context-sensitive shortcuts) but documented as code smell since it's unusual
   - Clear from labels they're context-dependent

2. **Repetitive pattern in TAB_SHORTCUTS:**
   - Lines 63-72: `goToTab1` through `goToTab9` and `goToLastTab` follow identical structure
   - Could be generated programmatically but current explicit form is more readable

3. **No unit tests for `shortcuts.ts`:**
   - Tests exist for `shortcutMatcher.ts` and `shortcutFormatter.ts`
   - No direct tests for the shortcut constant definitions themselves
   - Risk: typos or invalid key combinations not caught

## Type Safety Issues

1. **`keys` array allows any string:**
   - `Shortcut.keys: string[]` accepts any strings
   - Could accidentally use invalid key names like `'cmd'` instead of `'Meta'`
   - Example: A typo `['Meta', 'Shfit', 'k']` would compile but fail silently at runtime

2. **`useKeyboardShortcutHelpers.ts:23` exports explicit `any` type:**
   - `export type KeyboardHandlerContext = any;` (in `useMainKeyboardHandler.ts`)
   - Justified in comments but still weak typing for the shortcut context object

3. **Record key type allows arbitrary strings:**
   - `Record<string, Shortcut>` doesn't enforce known shortcut IDs
   - Typos in shortcut ID lookups like `isShortcut(e, 'toggleSideBar')` (wrong case) would silently fail

## Recommended Refactoring

1. **High Priority: Delete or integrate `shortcutMatcher.ts`**
   - The entire file is dead code in production
   - Option A: Delete `src/renderer/utils/shortcutMatcher.ts` and its test file
   - Option B: Refactor `useKeyboardShortcutHelpers.ts` to use `matchShortcut()` from `shortcutMatcher.ts`
   - Estimated: Remove ~105 lines of duplicate code

2. **Medium Priority: Add `ShortcutKey` literal type for key validation**
   ```typescript
   type ShortcutKey = 'Meta' | 'Ctrl' | 'Alt' | 'Shift' | 'ArrowUp' | 'ArrowDown' |
                      'ArrowLeft' | 'ArrowRight' | 'Backspace' | 'Enter' | 'Tab' |
                      'Escape' | string; // string for letter/number keys

   export interface Shortcut {
     id: string;
     label: string;
     keys: ShortcutKey[];
   }
   ```

3. **Medium Priority: Create `ShortcutId` union type**
   ```typescript
   type ShortcutId = keyof typeof DEFAULT_SHORTCUTS | keyof typeof TAB_SHORTCUTS | keyof typeof FIXED_SHORTCUTS;
   ```
   - Would catch typos in shortcut ID lookups at compile time

4. **Low Priority: Share shortcuts with mobile interface**
   - Export a subset of shortcuts that make sense for mobile
   - Have `useMobileKeyboardHandler.ts` import from shared constants
   - Ensures consistency between desktop and mobile

5. **Low Priority: Add shortcut validation at runtime (dev mode)**
   - Detect duplicate key combinations across all shortcut groups
   - Warn about potentially invalid key names

6. **Low Priority: Generate goToTab shortcuts programmatically**
   - Could reduce lines 63-72 from 10 entries to 3-line generator
   - Trade-off: less explicit but more maintainable

7. **Low Priority: Add unit tests for shortcuts.ts**
   - Test for unique IDs across all shortcut groups
   - Test for valid key names
   - Test for no duplicate key combinations (except intentional context-sensitive ones)

## Estimated Impact

- **Risk Level:** Low - shortcuts.ts itself is clean; issues are in related files
- **Testing:** Keyboard shortcut behavior should be manually verified after any changes
- **Priority items:** Deleting dead code in `shortcutMatcher.ts` is risk-free and high value
